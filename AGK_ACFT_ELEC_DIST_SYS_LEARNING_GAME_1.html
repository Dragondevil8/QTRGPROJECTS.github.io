<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGK ACFT ELEC DIST SYS LEARNING GAME 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* gray-900 */
        }

        .contactor {
            fill: #ef4444; /* red-500 */
            stroke: #f87171; /* red-400 */
            stroke-width: 1;
            transition: fill 0.3s ease;
        }

        .contactor-closed {
            fill: #22c55e; /* green-500 */
            stroke: #4ade80; /* green-400 */
        }
        
        .current-path {
            stroke-dasharray: 10, 5;
            animation: dash 1.5s linear infinite;
            stroke-width: 3.5;
            display: none; /* Hidden by default */
            stroke-linecap: round;
        }

        .power-ac { stroke: #60a5fa; } /* blue-400 */
        .power-dc { stroke: #facc15; } /* yellow-400 */
        .power-ess { stroke: #f472b6; } /* pink-400 */
        .power-bat { stroke: #34d399; } /* emerald-400 */

        @keyframes dash {
            from { stroke-dashoffset: 25; }
            to { stroke-dashoffset: 0; }
        }
    </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-7xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-400">AGK ACFT ELEC DISTRIBUTION LEARNING 1</h1>
            <p class="text-gray-400 mt-2">Select a scenario to visualize the power distribution and current flow.</p>
        </header>

        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div class="flex-grow">
                <label for="scenario-select" class="block mb-2 text-sm font-medium text-gray-300">Select Scenario:</label>
                <select id="scenario-select" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5">
                    <option selected value="0">--- Normal Operation ---</option>
                    <option value="1">1. GEN 2 feeds AC BUS 2</option>
                    <option value="2">2. GEN 2 feeds AC BUS 1</option>
                    <option value="3">3. EXT PWR feeds AC BUS 2</option>
                    <option value="4">4. GEN 2 feeds DC ESS BUS</option>
                    <option value="5">5. GEN 1 Failure (GEN 2 feeds DC BUS 1)</option>
                    <option value="6">6. TRU 1 Failure (TRU 2 feeds DC BUS 1)</option>
                    <option value="7">7. TRU 2 Failure (TRU 1 feeds DC BUS 2)</option>
                    <option value="8">8. GEN 2 feeds DC BAT BUS via AC BUS 1</option>
                    <option value="9">9. GEN 2 feeds DC BUS 2</option>
                    <option value="10">10. GEN 1 feeds DC ESS BUS</option>
                    <option value="11">11. APU GEN feeds AC BUS 1</option>
                    <option value="12">12. EXT PWR feeds both AC Buses</option>
                    <option value="13">13. GEN 1 feeds AC BUS 1</option>
                    <option value="14">14. EMER GEN feeds AC ESS BUS (Static Inv Fail)</option>
                    <option value="15">15. APU GEN feeds both AC Buses</option>
                    <option value="16">16. GEN 2 feeds DC BUS 1</option>
                    <option value="17">17. GEN 1 feeds AC BUS 2</option>
                    <option value="18">18. EXT PWR feeds AC BUS 1</option>
                    <option value="19">19. In-flight EMER GEN feeds AC ESS BUS</option>
                    <option value="20">20. GEN 2 feeds DC BAT BUS via DC BUS 2</option>
                    <option value="21">21. GEN 1 feeds DC BUS 2</option>
                    <option value="22">22. GEN 1 feeds DC BAT BUS</option>
                    <option value="23">23. APU GEN feeds AC BUS 2</option>
                    <option value="24">24. All AC Lost (Battery feeds AC ESS BUS)</option>
                    <option value="25">25. GEN 1 feeds DC BUS 1</option>
                </select>
            </div>
            <button id="reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg md:self-end">Reset System</button>
        </div>
        <div id="scenario-description" class="min-h-[40px] bg-gray-900/50 rounded-lg p-3 text-center text-cyan-300 font-medium mb-6">
            Normal operation: GEN 1 powers AC BUS 1 side, GEN 2 powers AC BUS 2 side. System is isolated.
        </div>

        <div class="bg-gray-900 rounded-lg p-2 md:p-4">
            <svg viewBox="0 0 1000 700" class="w-full">
                <!-- Defs for markers, etc -->
                <defs>
                    <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse">
                        <path d="M 0 0 L 10 5 L 0 10 z" fill="#facc15" />
                    </marker>
                </defs>

                <!-- TEXT LABELS -->
                <text x="75" y="650" class="fill-gray-300 text-sm" text-anchor="middle">GEN 1</text>
                <text x="300" y="650" class="fill-gray-300 text-sm" text-anchor="middle">EXT PWR</text>
                <text x="500" y="650" class="fill-gray-300 text-sm" text-anchor="middle">APU GEN</text>
                <text x="700" y="650" class="fill-gray-300 text-sm" text-anchor="middle">GEN 2</text>
                
                <text x="175" y="470" class="fill-gray-300 text-lg font-bold" text-anchor="middle">AC BUS 1</text>
                <text x="825" y="470" class="fill-gray-300 text-lg font-bold" text-anchor="middle">AC BUS 2</text>
                <text x="500" y="320" class="fill-gray-300 text-lg font-bold" text-anchor="middle">AC ESS BUS</text>

                <text x="175" y="220" class="fill-gray-300 text-lg font-bold" text-anchor="middle">DC BUS 1</text>
                <text x="825" y="220" class="fill-gray-300 text-lg font-bold" text-anchor="middle">DC BUS 2</text>
                <text x="500" y="170" class="fill-gray-300 text-lg font-bold" text-anchor="middle">DC ESS BUS</text>
                <text x="500" y="40" class="fill-gray-300 text-lg font-bold" text-anchor="middle">DC BAT BUS</text>

                <text x="100" y="325" class="fill-gray-300 text-sm" text-anchor="middle">TRU 1</text>
                <text x="900" y="325" class="fill-gray-300 text-sm" text-anchor="middle">TRU 2</text>
                <text x="500" y="245" class="fill-gray-300 text-sm" text-anchor="middle">ESS TRU</text>

                <text x="250" y="70" class="fill-gray-300 text-sm" text-anchor="middle">BATTERY 1</text>
                <text x="750" y="70" class="fill-gray-300 text-sm" text-anchor="middle">BATTERY 2</text>
                <text x="670" y="295" class="fill-gray-300 text-sm" text-anchor="middle">EMER GEN</text>
                <text x="350" y="280" class="fill-gray-300 text-sm" text-anchor="middle">STATIC<tspan x="350" dy="1.2em">INV</tspan></text>
                <text x="175" y="80" class="fill-gray-300 text-sm" text-anchor="middle">HOT BUS 1</text>
                <text x="825" y="80" class="fill-gray-300 text-sm" text-anchor="middle">HOT BUS 2</text>
                
                <!-- BUS BARS -->
                <rect x="100" y="475" width="150" height="15" rx="3" class="fill-blue-800" /> <!-- AC BUS 1 -->
                <rect x="750" y="475" width="150" height="15" rx="3" class="fill-blue-800" /> <!-- AC BUS 2 -->
                <rect x="350" y="325" width="300" height="15" rx="3" class="fill-pink-800" /> <!-- AC ESS BUS -->
                <rect x="100" y="225" width="150" height="15" rx="3" class="fill-yellow-800" /> <!-- DC BUS 1 -->
                <rect x="750" y="225" width="150" height="15" rx="3" class="fill-yellow-800" /> <!-- DC BUS 2 -->
                <rect x="300" y="175" width="400" height="15" rx="3" class="fill-pink-800" /> <!-- DC ESS BUS -->
                <rect x="150" y="45" width="700" height="15" rx="3" class="fill-emerald-800" /> <!-- DC BAT BUS -->
                <rect x="150" y="85" width="50" height="10" rx="2" class="fill-red-700" /> <!-- HOT BUS 1 -->
                <rect x="800" y="85" width="50" height="10" rx="2" class="fill-red-700" /> <!-- HOT BUS 2 -->

                <!-- POWER SOURCES (Circles) -->
                <circle cx="75" cy="610" r="25" class="fill-cyan-700" />
                <circle cx="300" cy="610" r="25" class="fill-gray-600" />
                <circle cx="500" cy="610" r="25" class="fill-amber-600" />
                <circle cx="700" cy="610" r="25" class="fill-cyan-700" />
                <circle cx="670" cy="320" r="20" class="fill-gray-600" /> <!-- EMER GEN -->

                <!-- BATTERIES / TRUs (Rects) -->
                <rect x="80" y="335" width="40" height="40" rx="5" class="fill-gray-700" /> <!-- TRU 1 -->
                <rect x="880" y="335" width="40" height="40" rx="5" class="fill-gray-700" /> <!-- TRU 2 -->
                <rect x="480" y="255" width="40" height="40" rx="5" class="fill-gray-700" /> <!-- ESS TRU -->
                <rect x="230" y="85" width="40" height="40" rx="5" class="fill-emerald-700" /> <!-- BAT 1 -->
                <rect x="730" y="85" width="40" height="40" rx="5" class="fill-emerald-700" /> <!-- BAT 2 -->
                <rect x="330" y="295" width="40" height="20" rx="3" class="fill-gray-700" /> <!-- STATIC INV -->

                <!-- TRU SYMBOLS -->
                <path d="M 85 355 L 115 355 M 100 355 L 100 370 M 90 370 L 110 370" stroke="white" stroke-width="1.5" fill="none" /> <!-- TRU 1 Symbol -->
                <path d="M 885 355 L 915 355 M 900 355 L 900 370 M 890 370 L 910 370" stroke="white" stroke-width="1.5" fill="none" /> <!-- TRU 2 Symbol -->
                <path d="M 485 275 L 515 275 M 500 275 L 500 290 M 490 290 L 510 290" stroke="white" stroke-width="1.5" fill="none" /> <!-- ESS TRU Symbol -->
                
                <!-- PATHS & CONTACTORS -->
                <!-- Group for paths -->
                <g id="current-paths"></g>
                <!-- Group for contactors (drawn on top) -->
                <g id="contactors"></g>

            </svg>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const svgPathsContainer = document.getElementById('current-paths');
            const svgContactorsContainer = document.getElementById('contactors');
            const scenarioSelect = document.getElementById('scenario-select');
            const resetButton = document.getElementById('reset-btn');
            const descriptionDisplay = document.getElementById('scenario-description');

            // --- DATA STRUCTURES ---

            // Define all contactor positions and IDs
            const contactorPositions = {
                'C1.1': { x: 75, y: 550 }, 'C1.2': { x: 300, y: 550 }, 'C1.3': { x: 500, y: 550 }, 'C1.4': { x: 700, y: 550 },
                'C2.1': { x: 250, y: 482.5 }, 'C2.2': { x: 750, y: 482.5 },
                'C3.1': { x: 350, y: 400 }, 'C3.2': { x: 650, y: 400 },
                'C4.1': { x: 660, y: 332.5 },
                'C5.1': { x: 175, y: 300 }, 'C5.2': { x: 500, y: 220 }, 'C5.3': { x: 825, y: 300 },
                'C6.1': { x: 370, y: 182.5 }, 'C6.2': { x: 340, y: 250 },
                'C7.1': { x: 175, y: 150 }, 'C7.2': { x: 250, y: 52.5 }, 'C7.3': { x: 750, y: 52.5 }, 'C7.4': { x: 825, y: 150 }
            };

            // Define all path segments
            const paths = {
                'gen1_c11': { d: 'M 75 610 V 550', class: 'power-ac' },
                'c11_ac1': { d: 'M 75 550 V 490 H 100', class: 'power-ac' },
                'ext_c12': { d: 'M 300 610 V 550', class: 'power-ac' },
                'c12_tie': { d: 'M 300 550 V 490 H 375', class: 'power-ac' },
                'apu_c13': { d: 'M 500 610 V 550', class: 'power-ac' },
                'c13_tie': { d: 'M 500 550 V 490 H 437.5', class: 'power-ac' },
                'gen2_c14': { d: 'M 700 610 V 550', class: 'power-ac' },
                'c14_ac2': { d: 'M 700 550 V 490 H 750', class: 'power-ac' },
                'ac1_c21': { d: 'M 250 482.5 H 375', class: 'power-ac' },
                'c21_tie_mid': { d: 'M 375 482.5 H 437.5', class: 'power-ac' },
                'tie_mid_c22': { d: 'M 437.5 482.5 H 625 H 750', class: 'power-ac' },
                'ac1_c31': { d: 'M 175 475 V 400 H 350', class: 'power-ac' },
                'ac2_c32': { d: 'M 825 475 V 400 H 650', class: 'power-ac' },
                'c31_acess': { d: 'M 350 400 V 340', class: 'power-ac' },
                'c32_acess': { d: 'M 650 400 V 340', class: 'power-ac' },
                'emer_c41': { d: 'M 670 320 H 660', class: 'power-ess' },
                'c41_acess': { d: 'M 660 332.5 V 325', class: 'power-ess' },
                'ac1_tru1': { d: 'M 175 475 V 375 H 100 V 355', class: 'power-ac' },
                'tru1_c51': { d: 'M 100 335 V 300 H 175', class: 'power-dc' },
                'c51_dc1': { d: 'M 175 300 V 240', class: 'power-dc' },
                'acess_esstru': { d: 'M 500 325 V 295', class: 'power-ac' },
                'esstru_c52': { d: 'M 500 255 V 220', class: 'power-dc' },
                'c52_dcess': { d: 'M 500 220 V 190', class: 'power-dc' },
                'ac2_tru2': { d: 'M 825 475 V 375 H 900 V 355', class: 'power-ac' },
                'tru2_c53': { d: 'M 900 335 V 300 H 825', class: 'power-dc' },
                'c53_dc2': { d: 'M 825 300 V 240', class: 'power-dc' },
                'dcess_c61': { d: 'M 370 182.5 V 175', class: 'power-bat' },
                'c61_batinv': { d: 'M 370 182.5 V 250 H 350', class: 'power-bat' },
                'batinv_c62': { d: 'M 350 295 V 325', class: 'power-ac' },
                'dc1_c71': { d: 'M 175 225 V 150', class: 'power-dc' },
                'c71_dcbat': { d: 'M 175 150 V 60', class: 'power-dc' },
                'bat1_c72': { d: 'M 250 85 V 52.5', class: 'power-bat' },
                'bat2_c73': { d: 'M 750 85 V 52.5', class: 'power-bat' },
                'dc2_c74': { d: 'M 825 225 V 150', class: 'power-dc' },
                'c74_dcbat': { d: 'M 825 150 V 60', class: 'power-dc' },
                'dcbat_mid_c71': { d: 'M 500 52.5 H 175', class: 'power-dc' },
                'dcbat_mid_c74': { d: 'M 500 52.5 H 825', class: 'power-dc' },
                 'hotbus1_bat1': { d: 'M 200 90 H 230', class: 'power-bat' },
                'dcbat_hotbus1': { d: 'M 175 60 V 85 H 150', class: 'power-bat' },
                'hotbus2_bat2': { d: 'M 800 90 H 770', class: 'power-bat' },
                'dcbat_hotbus2': { d: 'M 825 60 V 85 H 850', class: 'power-bat' }
            };

            // Define scenarios: contactors to close, paths to show, and description
            const scenarios = {
                0: { // Normal Operation
                    contactors: ['C1.1', 'C1.4', 'C5.1', 'C5.3', 'C7.2', 'C7.3'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_tru1', 'tru1_c51', 'c51_dc1', 'gen2_c14', 'c14_ac2', 'ac2_tru2', 'tru2_c53', 'c53_dc2', 'bat1_c72', 'bat2_c73', 'dcbat_hotbus1', 'hotbus1_bat1', 'dcbat_hotbus2', 'hotbus2_bat2'],
                    description: 'Normal: GEN 1 powers left side, GEN 2 powers right side. Buses are isolated. Batteries connected.'
                },
                1: {
                    contactors: ['C1.4'],
                    paths: ['gen2_c14', 'c14_ac2'],
                    description: 'GEN 2 feeding AC BUS 2.'
                },
                2: {
                    contactors: ['C1.4', 'C2.2', 'C2.1'],
                    paths: ['gen2_c14', 'c14_ac2', 'tie_mid_c22', 'c21_tie_mid', 'ac1_c21'],
                    description: 'GEN 2 feeding AC BUS 1 via AC BUS 2 and Bus Tie.'
                },
                3: {
                    contactors: ['C1.2', 'C2.2'],
                    paths: ['ext_c12', 'c12_tie', 'c21_tie_mid', 'tie_mid_c22'],
                    description: 'External Power feeding AC BUS 2 via Bus Tie.'
                },
                4: {
                    contactors: ['C1.4', 'C3.2', 'C5.2'],
                    paths: ['gen2_c14', 'c14_ac2', 'ac2_c32', 'c32_acess', 'acess_esstru', 'esstru_c52', 'c52_dcess'],
                    description: 'GEN 2 feeding DC ESS BUS via AC BUS 2 and ESS TRU.'
                },
                5: {
                    contactors: ['C1.4', 'C2.2', 'C2.1', 'C5.1'],
                    paths: ['gen2_c14', 'c14_ac2', 'tie_mid_c22', 'c21_tie_mid', 'ac1_c21', 'ac1_tru1', 'tru1_c51', 'c51_dc1'],
                    description: 'GEN 1 Failure: GEN 2 feeds DC BUS 1 via Bus Tie and TRU 1.'
                },
                6: {
                    contactors: ['C5.3', 'C7.4', 'C7.1'],
                    paths: ['tru2_c53', 'c53_dc2', 'dc2_c74', 'c74_dcbat', 'dcbat_mid_c71', 'c71_dcbat', 'dc1_c71'],
                    description: 'TRU 1 Failure: TRU 2 feeds DC BUS 1 via DC BUS 2 and DC BAT BUS.'
                },
                7: {
                    contactors: ['C5.1', 'C7.1', 'C7.4'],
                    paths: ['tru1_c51', 'c51_dc1', 'dc1_c71', 'c71_dcbat', 'dcbat_mid_c74', 'c74_dcbat', 'dc2_c74'],
                    description: 'TRU 2 Failure: TRU 1 feeds DC BUS 2 via DC BUS 1 and DC BAT BUS.'
                },
                 8: {
                    contactors: ['C1.4', 'C2.1', 'C2.2', 'C5.1', 'C7.1'],
                    paths: ['gen2_c14', 'c14_ac2', 'tie_mid_c22', 'c21_tie_mid', 'ac1_c21', 'ac1_tru1', 'tru1_c51', 'c51_dc1', 'dc1_c71', 'c71_dcbat'],
                    description: 'GEN 2 feeds DC BAT BUS via AC BUS 2, AC BUS 1, DC BUS 1.'
                },
                9: {
                    contactors: ['C1.4', 'C5.3'],
                    paths: ['gen2_c14', 'c14_ac2', 'ac2_tru2', 'tru2_c53', 'c53_dc2'],
                    description: 'GEN 2 feeding DC BUS 2.'
                },
                10: {
                    contactors: ['C1.1', 'C3.1', 'C5.2'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_c31', 'c31_acess', 'acess_esstru', 'esstru_c52', 'c52_dcess'],
                    description: 'GEN 1 feeding DC ESS BUS via AC BUS 1 and ESS TRU.'
                },
                11: {
                    contactors: ['C1.3', 'C2.1'],
                    paths: ['apu_c13', 'c13_tie', 'c21_tie_mid', 'ac1_c21'],
                    description: 'APU GEN feeding AC BUS 1.'
                },
                12: {
                    contactors: ['C1.2', 'C2.1', 'C2.2'],
                    paths: ['ext_c12', 'c12_tie', 'c21_tie_mid', 'ac1_c21', 'tie_mid_c22'],
                    description: 'External Power feeding both AC BUS 1 and AC BUS 2.'
                },
                13: {
                    contactors: ['C1.1'],
                    paths: ['gen1_c11', 'c11_ac1'],
                    description: 'GEN 1 feeding AC BUS 1.'
                },
                14: {
                    contactors: ['C4.1'],
                    paths: ['emer_c41', 'c41_acess'],
                    description: 'Static Inverter Failure: EMER GEN feeds AC ESS BUS.'
                },
                15: {
                    contactors: ['C1.3', 'C2.1', 'C2.2'],
                    paths: ['apu_c13', 'c13_tie', 'c21_tie_mid', 'ac1_c21', 'tie_mid_c22'],
                    description: 'APU GEN feeding both AC BUS 1 and AC BUS 2.'
                },
                16: {
                    contactors: ['C1.4', 'C2.2', 'C2.1', 'C5.1'],
                    paths: ['gen2_c14', 'c14_ac2', 'tie_mid_c22', 'c21_tie_mid', 'ac1_c21', 'ac1_tru1', 'tru1_c51', 'c51_dc1'],
                    description: 'GEN 2 feeding DC BUS 1.'
                },
                17: {
                    contactors: ['C1.1', 'C2.1', 'C2.2'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_c21', 'c21_tie_mid', 'tie_mid_c22'],
                    description: 'GEN 1 feeding AC BUS 2 via AC BUS 1 and Bus Tie.'
                },
                18: {
                    contactors: ['C1.2', 'C2.1'],
                    paths: ['ext_c12', 'c12_tie', 'c21_tie_mid', 'ac1_c21'],
                    description: 'External Power feeding AC BUS 1.'
                },
                19: {
                    contactors: ['C4.1'],
                    paths: ['emer_c41', 'c41_acess'],
                    description: 'In-flight: EMER GEN feeds AC ESS BUS.'
                },
                20: {
                    contactors: ['C1.4', 'C5.3', 'C7.4'],
                    paths: ['gen2_c14', 'c14_ac2', 'ac2_tru2', 'tru2_c53', 'c53_dc2', 'dc2_c74', 'c74_dcbat'],
                    description: 'GEN 2 feeds DC BAT BUS via AC BUS 2 and DC BUS 2.'
                },
                21: {
                    contactors: ['C1.1', 'C2.2', 'C2.1', 'C5.3'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_c21', 'c21_tie_mid', 'tie_mid_c22', 'ac2_tru2', 'tru2_c53', 'c53_dc2'],
                    description: 'GEN 1 feeds DC BUS 2.'
                },
                22: {
                    contactors: ['C1.1', 'C5.1', 'C7.1'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_tru1', 'tru1_c51', 'c51_dc1', 'dc1_c71', 'c71_dcbat'],
                    description: 'GEN 1 feeds DC BAT BUS via AC BUS 1 and DC BUS 1.'
                },
                23: {
                    contactors: ['C1.3', 'C2.2'],
                    paths: ['apu_c13', 'c13_tie', 'c21_tie_mid', 'tie_mid_c22'],
                    description: 'APU GEN feeding AC BUS 2.'
                },
                24: {
                    contactors: ['C6.1', 'C6.2'],
                    paths: ['dcess_c61', 'c61_batinv', 'batinv_c62'],
                    description: 'All AC GEN Lost: Batteries feed AC ESS BUS via Static Inverter.'
                },
                25: {
                    contactors: ['C1.1', 'C5.1'],
                    paths: ['gen1_c11', 'c11_ac1', 'ac1_tru1', 'tru1_c51', 'c51_dc1'],
                    description: 'GEN 1 feeding DC BUS 1.'
                }
            };

            // --- FUNCTIONS ---

            // Function to create an SVG element
            function createSVGElement(tag, attributes) {
                const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
                for (let key in attributes) {
                    el.setAttribute(key, attributes[key]);
                }
                return el;
            }
            
            // Function to draw all components once
            function initializeDiagram() {
                // Draw Paths
                for (let id in paths) {
                    const pathData = paths[id];
                    const pathEl = createSVGElement('path', {
                        id: 'path-' + id,
                        d: pathData.d,
                        class: `current-path ${pathData.class}`,
                        fill: 'none'
                    });
                    svgPathsContainer.appendChild(pathEl);
                }

                // Draw Contactors
                for (let id in contactorPositions) {
                    const pos = contactorPositions[id];
                    const contactorEl = createSVGElement('circle', {
                        id: 'contactor-' + id,
                        cx: pos.x,
                        cy: pos.y,
                        r: 7,
                        class: 'contactor'
                    });
                    svgContactorsContainer.appendChild(contactorEl);
                }
            }

            // Function to reset the system to a clean slate
            function resetSystem() {
                // Hide all paths
                document.querySelectorAll('.current-path').forEach(p => p.style.display = 'none');
                // Open all contactors (set to default red color)
                document.querySelectorAll('.contactor').forEach(c => c.classList.remove('contactor-closed'));
            }

            // Function to activate a specific scenario
            function activateScenario(scenarioId) {
                resetSystem();
                const scenario = scenarios[scenarioId];
                if (!scenario) return;

                // Close specified contactors
                scenario.contactors.forEach(contactorId => {
                    const el = document.getElementById('contactor-' + contactorId);
                    if (el) el.classList.add('contactor-closed');
                });

                // Show specified paths
                scenario.paths.forEach(pathId => {
                    const el = document.getElementById('path-' + pathId);
                    if (el) el.style.display = 'block';
                });

                // Update description
                descriptionDisplay.textContent = scenario.description;
            }

            // --- EVENT LISTENERS ---
            scenarioSelect.addEventListener('change', (e) => {
                activateScenario(e.target.value);
            });

            resetButton.addEventListener('click', () => {
                scenarioSelect.value = "0";
                activateScenario("0");
            });

            // --- INITIALIZATION ---
            initializeDiagram();
            activateScenario("0"); // Start with normal operation
        });
    </script>
</body>
</html>
